<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dominó de Potencias - Matemáticas Interactivas</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom right, #f0f9ff, #e0f2fe, #fae8ff);
      color: #1e293b;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      max-width: 1200px;
      width: 100%;
      text-align: center;
    }

    header {
      margin-bottom: 20px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #0ea5e9, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: none;
    }

    .subtitle {
      font-size: 1.2rem;
      margin-bottom: 20px;
      color: #475569;
    }

    .game-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      background: rgba(255, 255, 255, 0.7);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .info-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .info-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: #0ea5e9;
    }

    .info-label {
      font-size: 0.9rem;
      color: #64748b;
    }

    .game-area {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .game-area {
        flex-direction: column;
      }
    }

    #mano {
      width: 250px;
      min-height: 400px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #tablero {
      flex: 1;
      min-height: 400px;
      background: rgba(255, 255, 255, 0.5);
      border: 2px dashed #cbd5e1;
      border-radius: 15px;
      position: relative;
      overflow: hidden;
    }

    .ficha {
      width: 120px;
      height: 60px;
      background: white;
      border: 2px solid #0ea5e9;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      cursor: grab;
      position: absolute;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }

    .ficha:hover {
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      transform: scale(1.05);
    }

    .ficha.conectada {
      border-color: #10b981;
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }

    .lado {
      width: 45%;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: #1e293b;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .separador {
      width: 2px;
      height: 80%;
      background: #0ea5e9;
      border-radius: 1px;
    }

    .botones {
      position: absolute;
      bottom: -35px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
    }

    .botones button {
      padding: 4px 8px;
      font-size: 12px;
      background: #0ea5e9;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .botones button:hover {
      background: #0284c7;
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    button {
      padding: 12px 24px;
      font-size: 1rem;
      background: #0ea5e9;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    button:hover {
      background: #0284c7;
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }

    button:active {
      transform: translateY(0);
    }

    .message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      color: #1e293b;
      padding: 20px 40px;
      border-radius: 10px;
      font-size: 1.5rem;
      z-index: 100;
      display: none;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      border: 2px solid #0ea5e9;
    }

    .conexion {
      position: absolute;
      height: 4px;
      background: #10b981;
      z-index: 5;
      transform-origin: 0 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Dominó de Potencias</h1>
      <p class="subtitle">Conecta las expresiones equivalentes para ganar puntos</p>
    </header>

    <div class="game-info">
      <div class="info-item">
        <div class="info-value" id="puntuacion">0</div>
        <div class="info-label">Puntuación</div>
      </div>
      <div class="info-item">
        <div class="info-value" id="fichas-conectadas">0</div>
        <div class="info-label">Fichas Conectadas</div>
      </div>
      <div class="info-item">
        <div class="info-value" id="tiempo">120</div>
        <div class="info-label">Tiempo Restante</div>
      </div>
    </div>

    <div class="game-area">
      <div id="mano">
        <h3>Tu Mano</h3>
        <p>Arrastra las fichas al tablero</p>
      </div>
      <div id="tablero"></div>
    </div>

    <div class="controls">
      <button id="btn-repartir">Repartir Fichas</button>
      <button id="btn-reiniciar">Reiniciar Juego</button>
      <button id="btn-voltear-todas">Voltear Todas</button>
    </div>
  </div>

  <div class="message" id="message"></div>

  <script>
    // Configuración del juego
    const config = {
      tiempoTotal: 120, // segundos
      puntosPorConexion: 10,
      puntosExtraPorCadena: 5
    };

    // Estado del juego
    let estado = {
      puntuacion: 0,
      fichasConectadas: 0,
      tiempoRestante: config.tiempoTotal,
      temporizador: null,
      fichasEnTablero: [],
      conexiones: [],
      fichaActiva: null
    };

    // Expresiones para las fichas
    const expresiones = [
      // Formato: [expresión1, expresión2, valor numérico]
      ["2^2", "4", 4],
      ["2^3", "8", 8],
      ["2^4", "16", 16],
      ["2^5", "32", 32],
      ["3^2", "9", 9],
      ["3^3", "27", 27],
      ["4^2", "16", 16],
      ["4^3", "64", 64],
      ["5^2", "25", 25],
      ["5^3", "125", 125],
      ["10^2", "100", 100],
      ["10^3", "1000", 1000],
      ["2^2 * 2^3", "32", 32],
      ["3^2 * 2^2", "36", 36],
      ["2^4 / 2^2", "4", 4],
      ["3^3 / 3", "9", 9],
      ["√16", "4", 4],
      ["√81", "9", 9],
      ["2^0", "1", 1],
      ["5^0", "1", 1]
    ];

    // Elementos DOM
    const tablero = document.getElementById('tablero');
    const mano = document.getElementById('mano');
    const puntuacionElement = document.getElementById('puntuacion');
    const fichasConectadasElement = document.getElementById('fichas-conectadas');
    const tiempoElement = document.getElementById('tiempo');
    const messageElement = document.getElementById('message');

    // Inicialización del juego
    function inicializarJuego() {
      clearInterval(estado.temporizador);
      estado = {
        puntuacion: 0,
        fichasConectadas: 0,
        tiempoRestante: config.tiempoTotal,
        temporizador: null,
        fichasEnTablero: [],
        conexiones: [],
        fichaActiva: null
      };
      
      actualizarUI();
      repartirFichas();
      iniciarTemporizador();
    }

    // Repartir fichas iniciales
    function repartirFichas() {
      // Limpiar mano y tablero
      mano.innerHTML = '<h3>Tu Mano</h3><p>Arrastra las fichas al tablero</p>';
      tablero.innerHTML = '';
      estado.fichasEnTablero = [];
      estado.conexiones = [];
      
      // Crear 8 fichas aleatorias
      const fichasAleatorias = [];
      const indicesUsados = new Set();
      
      while (fichasAleatorias.length < 8 && indicesUsados.size < expresiones.length) {
        const indice = Math.floor(Math.random() * expresiones.length);
        if (!indicesUsados.has(indice)) {
          indicesUsados.add(indice);
          const [a, b, valor] = expresiones[indice];
          
          // Decidir aleatoriamente si voltear la ficha
          const volteada = Math.random() > 0.5;
          fichasAleatorias.push({
            id: fichasAleatorias.length + 1,
            a: volteada ? b : a,
            b: volteada ? a : b,
            valor: valor,
            rotacion: 0
          });
        }
      }
      
      // Colocar fichas en la mano
      fichasAleatorias.forEach((ficha, index) => {
        const fichaElement = crearFicha(ficha);
        fichaElement.style.position = 'relative';
        fichaElement.style.top = 'auto';
        fichaElement.style.left = 'auto';
        fichaElement.style.margin = '10px 0';
        mano.appendChild(fichaElement);
      });
    }

    // Crear elemento ficha
    function crearFicha(f) {
      const div = document.createElement("div");
      div.className = "ficha";
      div.dataset.id = f.id;
      div.dataset.valor = f.valor;
      div.dataset.rotacion = f.rotacion || 0;

      div.innerHTML = `
        <div class="lado">${f.a}</div>
        <div class="separador"></div>
        <div class="lado">${f.b}</div>
        <div class="botones">
          <button class="rotarL">↺</button>
          <button class="rotarR">↻</button>
        </div>
      `;

      // Rotación
      div.querySelector(".rotarL").onclick = (e) => {
        e.stopPropagation();
        let rot = parseInt(div.dataset.rotacion) - 90;
        div.dataset.rotacion = rot;
        div.style.transform = `rotate(${rot}deg)`;
        verificarConexionesCercanas(div);
      };

      div.querySelector(".rotarR").onclick = (e) => {
        e.stopPropagation();
        let rot = parseInt(div.dataset.rotacion) + 90;
        div.dataset.rotacion = rot;
        div.style.transform = `rotate(${rot}deg)`;
        verificarConexionesCercanas(div);
      };

      activarArrastre(div);
      return div;
    }

    // Activar arrastre de fichas - CORREGIDO
    function activarArrastre(elem) {
      let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      
      elem.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // Obtener la posición inicial del cursor
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
        elem.style.zIndex = "1000";
        estado.fichaActiva = elem;
      }

      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // Calcular la nueva posición
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        // Establecer la nueva posición
        elem.style.top = (elem.offsetTop - pos2) + "px";
        elem.style.left = (elem.offsetLeft - pos1) + "px";
      }

      function closeDragElement() {
        // Detener el movimiento
        document.onmouseup = null;
        document.onmousemove = null;
        elem.style.zIndex = "10";
        
        // Verificar si la ficha se soltó en el tablero
        const rect = tablero.getBoundingClientRect();
        const fichaRect = elem.getBoundingClientRect();
        
        if (
          fichaRect.left >= rect.left && 
          fichaRect.right <= rect.right &&
          fichaRect.top >= rect.top && 
          fichaRect.bottom <= rect.bottom
        ) {
          // Verificar si la ficha ya está en el tablero
          if (!estado.fichasEnTablero.some(f => f.id == elem.dataset.id)) {
            estado.fichasEnTablero.push({
              id: parseInt(elem.dataset.id),
              elemento: elem,
              valor: parseInt(elem.dataset.valor),
              x: parseInt(elem.style.left),
              y: parseInt(elem.style.top),
              rotacion: parseInt(elem.dataset.rotacion)
            });
          }
          
          verificarConexionesCercanas(elem);
        }
        
        estado.fichaActiva = null;
      }
    }

    // Verificar conexiones cercanas
    function verificarConexionesCercanas(fichaElement) {
      const fichaId = parseInt(fichaElement.dataset.id);
      const fichaValor = parseInt(fichaElement.dataset.valor);
      const fichaX = parseInt(fichaElement.style.left);
      const fichaY = parseInt(fichaElement.style.top);
      
      // Buscar fichas cercanas con el mismo valor
      estado.fichasEnTablero.forEach(otraFicha => {
        if (otraFicha.id !== fichaId && otraFicha.valor === fichaValor) {
          const otraX = otraFicha.x;
          const otraY = otraFicha.y;
          
          // Calcular distancia
          const distancia = Math.sqrt(Math.pow(fichaX - otraX, 2) + Math.pow(fichaY - otraY, 2));
          
          if (distancia < 150) { // Umbral de conexión
            conectarFichas(fichaElement, otraFicha.elemento);
          }
        }
      });
    }

    // Conectar dos fichas
    function conectarFichas(ficha1, ficha2) {
      const id1 = parseInt(ficha1.dataset.id);
      const id2 = parseInt(ficha2.dataset.id);
      
      // Verificar si ya están conectadas
      if (estado.conexiones.some(c => 
        (c.ficha1 === id1 && c.ficha2 === id2) || 
        (c.ficha1 === id2 && c.ficha2 === id1)
      )) {
        return;
      }
      
      // Marcar como conectadas visualmente
      ficha1.classList.add('conectada');
      ficha2.classList.add('conectada');
      
      // Agregar conexión al estado
      estado.conexiones.push({
        ficha1: id1,
        ficha2: id2
      });
      
      // Dibujar línea de conexión
      dibujarConexion(ficha1, ficha2);
      
      // Actualizar puntuación
      estado.puntuacion += config.puntosPorConexion;
      estado.fichasConectadas += 2;
      
      // Verificar si se completó el juego
      if (estado.fichasConectadas >= 8) {
        mostrarMensaje("¡Felicidades! Has conectado todas las fichas", true);
      }
      
      actualizarUI();
    }

    // Dibujar línea de conexión entre fichas
    function dibujarConexion(ficha1, ficha2) {
      const rect1 = ficha1.getBoundingClientRect();
      const rect2 = ficha2.getBoundingClientRect();
      const tableroRect = tablero.getBoundingClientRect();
      
      const x1 = rect1.left + rect1.width/2 - tableroRect.left;
      const y1 = rect1.top + rect1.height/2 - tableroRect.top;
      const x2 = rect2.left + rect2.width/2 - tableroRect.left;
      const y2 = rect2.top + rect2.height/2 - tableroRect.top;
      
      const conexion = document.createElement('div');
      conexion.className = 'conexion';
      
      const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
      const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
      
      conexion.style.width = `${length}px`;
      conexion.style.left = `${x1}px`;
      conexion.style.top = `${y1}px`;
      conexion.style.transform = `rotate(${angle}deg)`;
      
      tablero.appendChild(conexion);
    }

    // Voltear todas las fichas
    function voltearTodasLasFichas() {
      const fichas = document.querySelectorAll('.ficha');
      fichas.forEach(ficha => {
        let rot = parseInt(ficha.dataset.rotacion) + 180;
        ficha.dataset.rotacion = rot;
        ficha.style.transform = `rotate(${rot}deg)`;
      });
    }

    // Mostrar mensaje
    function mostrarMensaje(texto, esVictoria = false) {
      messageElement.textContent = texto;
      messageElement.style.display = 'block';
      messageElement.style.background = esVictoria ? 
        'rgba(16, 185, 129, 0.9)' : 'rgba(255, 255, 255, 0.95)';
      
      setTimeout(() => {
        messageElement.style.display = 'none';
      }, 3000);
    }

    // Iniciar temporizador
    function iniciarTemporizador() {
      estado.temporizador = setInterval(() => {
        estado.tiempoRestante--;
        tiempoElement.textContent = estado.tiempoRestante;
        
        if (estado.tiempoRestante <= 0) {
          clearInterval(estado.temporizador);
          mostrarMensaje("¡Tiempo agotado! Tu puntuación: " + estado.puntuacion);
        }
      }, 1000);
    }

    // Actualizar UI
    function actualizarUI() {
      puntuacionElement.textContent = estado.puntuacion;
      fichasConectadasElement.textContent = estado.fichasConectadas;
      tiempoElement.textContent = estado.tiempoRestante;
    }

    // Event listeners para botones
    document.getElementById('btn-repartir').onclick = repartirFichas;
    document.getElementById('btn-reiniciar').onclick = inicializarJuego;
    document.getElementById('btn-voltear-todas').onclick = voltearTodasLasFichas;

    // Inicializar el juego al cargar
    window.onload = inicializarJuego;
  </script>
</body>
</html>
