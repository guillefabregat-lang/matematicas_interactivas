<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MCM Visual ‚Äì Torres de M√∫ltiplos</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
    .block {
        width: 70px;
        margin-top: 4px;
        border-radius: 8px;
        animation: grow 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        position: relative;
        font-weight: bold;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 3px solid rgba(255,255,255,0.3);
        min-height: 30px;
    }
    
    @keyframes grow {
        from { 
            transform: scaleY(0) rotateZ(-5deg); 
            opacity: 0; 
        }
        to { 
            transform: scaleY(1) rotateZ(0deg); 
            opacity: 1; 
        }
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    @keyframes shine {
        0% { box-shadow: 0 0 5px rgba(255,215,0,0.5); }
        50% { box-shadow: 0 0 20px rgba(255,215,0,0.8), 0 0 30px rgba(255,215,0,0.6); }
        100% { box-shadow: 0 0 5px rgba(255,215,0,0.5); }
    }
    
    .mcm-match {
        animation: shine 1.5s ease-in-out infinite;
        border: 4px solid gold !important;
        font-size: 1.1em;
    }
    
    .reference-line {
        position: absolute;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, rgba(100,100,100,0.3), transparent);
        pointer-events: none;
        transition: all 0.3s ease;
    }
    
    .reference-line.highlight {
        background: linear-gradient(90deg, transparent, rgba(234,179,8,0.8), transparent);
        height: 3px;
        box-shadow: 0 0 10px rgba(234,179,8,0.5);
    }
    
    .reference-line-label {
        position: absolute;
        right: -50px;
        top: -10px;
        font-size: 12px;
        color: #666;
        font-weight: bold;
        background: white;
        padding: 2px 6px;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .reference-line.highlight .reference-line-label {
        color: #ca8a04;
        background: #fef3c7;
        border: 2px solid gold;
    }
    
    .tower-container {
        position: relative;
        min-height: 500px;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
    }
    
    .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background: #f0f;
        position: absolute;
        animation: confetti-fall 3s linear;
    }
    
    @keyframes confetti-fall {
        to {
            transform: translateY(100vh) rotate(360deg);
            opacity: 0;
        }
    }
</style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-indigo-100 min-h-screen p-4">

<!-- CONTENEDOR PRINCIPAL -->
<div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl p-8">

    <h1 class="text-4xl font-bold text-center bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-6">
        üèóÔ∏è Torres de M√∫ltiplos - Encuentra el MCM
    </h1>
    
    <p class="text-center text-gray-600 mb-6">Haz clic en cada torre para apilar m√∫ltiplos. ¬°Cuando coincidan, encontrar√°s el MCM!</p>

    <!-- Selecci√≥n de n√∫meros -->
    <div class="flex gap-4 justify-center mb-8 flex-wrap">
        <input type="number" id="n1" value="4" class="w-24 px-3 py-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 outline-none" placeholder="N√∫mero 1" />
        <input type="number" id="n2" value="6" class="w-24 px-3 py-2 border-2 border-green-300 rounded-lg focus:border-green-500 outline-none" placeholder="N√∫mero 2" />
        <input type="number" id="n3" class="w-24 px-3 py-2 border-2 border-purple-300 rounded-lg focus:border-purple-500 outline-none" placeholder="(Opcional)" />
        <button onclick="start()" class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg">
            üöÄ Iniciar
        </button>
        <button onclick="reset()" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-all">
            üîÑ Reiniciar
        </button>
    </div>

    <!-- Torres -->
    <div id="columns" class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center relative"></div>

    <div id="result" class="text-center text-2xl font-bold mt-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-300 hidden">
        <div class="text-4xl mb-2">üéâ</div>
        <div id="result-text"></div>
    </div>

</div>


<!-- ==========================
   L√ìGICA DEL JUEGO
=========================== -->
<script>
let nums = [];
let multiples = [];
let active = false;
let colors = ['#3b82f6', '#10b981', '#a855f7', '#f59e0b', '#ef4444'];
let allMultiples = new Set();

/* ---- INICIO ---- */
function start() {
    const a = parseInt(document.getElementById('n1').value);
    const b = parseInt(document.getElementById('n2').value);
    const c = parseInt(document.getElementById('n3').value);

    nums = [a, b];
    if (!isNaN(c) && c > 0) nums.push(c);

    if (nums.some(n => isNaN(n) || n <= 0)) return alert("Introduce n√∫meros v√°lidos (mayores que 0).");

    multiples = nums.map(() => []);
    allMultiples.clear();
    active = true;

    renderColumns();
    document.getElementById("result").classList.add("hidden");

    scormStart();
}

/* ---- REINICIAR ---- */
function reset() {
    multiples = nums.map(() => []);
    allMultiples.clear();
    active = true;
    renderColumns();
    document.getElementById("result").classList.add("hidden");
}

/* ---- DIBUJAR COLUMNAS ---- */
function renderColumns() {
    const col = document.getElementById("columns");
    col.innerHTML = "";

    nums.forEach((n, i) => {
        const container = document.createElement("div");
        container.className = "bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-lg cursor-pointer hover:shadow-xl hover:scale-105 transition-all border-2 border-gray-200";
        container.onclick = () => addBlock(i);
        container.style.borderColor = colors[i];

        container.innerHTML = `
            <div class="text-2xl font-bold mb-3" style="color: ${colors[i]}">Torre √ó ${n}</div>
            <div class="tower-container relative">
                <div id="tower-${i}" class="flex flex-col-reverse items-center relative z-10"></div>
                <div id="lines-${i}" class="absolute inset-0 z-0"></div>
            </div>
            <div id="label-${i}" class="text-sm mt-3 text-gray-600 font-semibold">Haz clic para apilar</div>
        `;

        col.appendChild(container);
    });
    
    updateReferenceLines();
}

/* ---- A√ëADIR BLOQUE ---- */
function addBlock(i) {
    if (!active) return;

    const n = nums[i];
    const next = (multiples[i].length + 1) * n;
    multiples[i].push(next);
    allMultiples.add(next);

    const tower = document.getElementById("tower-" + i);
    const block = document.createElement("div");
    block.className = "block";
    block.textContent = next;
    block.style.backgroundColor = colors[i];
    block.dataset.value = next;
    
    // Hacer que la altura sea proporcional al valor
    // Usamos una escala base de 3px por unidad, con m√≠nimo de 30px
    const heightPixels = Math.max(30, next * 3);
    block.style.height = heightPixels + "px";
    block.style.fontSize = (next > 20 ? "0.9em" : "1em");

    tower.appendChild(block);

    document.getElementById("label-" + i).textContent = `√öltimo: ${next}`;

    updateReferenceLines();
    checkMCM();
}

/* ---- ACTUALIZAR L√çNEAS DE REFERENCIA ---- */
function updateReferenceLines() {
    // Obtener el m√°ximo valor para calcular proporciones
    const maxVal = Math.max(...Array.from(allMultiples), 1);
    
    nums.forEach((n, i) => {
        const linesContainer = document.getElementById("lines-" + i);
        linesContainer.innerHTML = "";
        
        // Calcular la altura acumulada de los bloques en esta torre
        let towerHeight = 0;
        multiples[i].forEach(val => {
            towerHeight += Math.max(30, val * 3);
        });
        
        Array.from(allMultiples).sort((a,b) => a-b).forEach(val => {
            const line = document.createElement("div");
            line.className = "reference-line";
            
            // Calcular la posici√≥n basada en el valor
            let positionHeight = 0;
            for (let j = 0; j < multiples[i].length; j++) {
                const blockVal = multiples[i][j];
                if (blockVal < val) {
                    positionHeight += Math.max(30, blockVal * 3);
                } else if (blockVal === val) {
                    positionHeight += Math.max(30, blockVal * 3);
                    break;
                }
            }
            
            // Si este m√∫ltiplo est√° en la torre, posicionar la l√≠nea ah√≠
            if (multiples[i].includes(val)) {
                line.style.bottom = `${positionHeight - 4}px`;
            } else {
                // Si no est√° en la torre, calcular proporcionalmente
                line.style.bottom = `${(val * 3)}px`;
                line.style.opacity = "0.3";
            }
            
            const label = document.createElement("span");
            label.className = "reference-line-label";
            label.textContent = val;
            line.appendChild(label);
            
            linesContainer.appendChild(line);
        });
    });
}

/* ---- DETECTAR SI COINCIDEN ---- */
function checkMCM() {
    let intersections = multiples.reduce((acc, arr) =>
        acc.filter(x => arr.includes(x))
    );

    if (intersections.length > 0) {
        const mcm = Math.min(...intersections);
        showResult(mcm);
        highlightMCM(mcm);
        scormFinish(mcm);
    }
}

/* ---- RESALTAR MCM EN LAS TORRES ---- */
function highlightMCM(mcm) {
    // Resaltar bloques que coinciden
    nums.forEach((n, i) => {
        const tower = document.getElementById("tower-" + i);
        const blocks = tower.querySelectorAll(".block");
        blocks.forEach(block => {
            if (parseInt(block.dataset.value) === mcm) {
                block.classList.add("mcm-match");
            }
        });
    });
    
    // Resaltar l√≠neas de referencia
    document.querySelectorAll(".reference-line").forEach(line => {
        const label = line.querySelector(".reference-line-label");
        if (label && parseInt(label.textContent) === mcm) {
            line.classList.add("highlight");
        }
    });
    
    // Confetti
    createConfetti();
}

/* ---- CONFETTI ---- */
function createConfetti() {
    const colors = ['#3b82f6', '#10b981', '#a855f7', '#f59e0b', '#ef4444', '#ec4899'];
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = Math.random() * 100 + "vw";
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 0.5 + "s";
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
    }
}

/* ---- MOSTRAR RESULTADO ---- */
function showResult(mcm) {
    active = false;

    const r = document.getElementById("result");
    const rt = document.getElementById("result-text");
    rt.innerHTML = `¬°MCM encontrado! El <span class="text-green-600">M√≠nimo Com√∫n M√∫ltiplo</span> es <span class="text-3xl text-indigo-700">${mcm}</span>`;
    r.classList.remove("hidden");
}

/* ==========================
   SCORM API (m√≠nima)
========================== */
let api = null;

function scormGetAPI() {
    if (api) return api;
    if (window.parent && window.parent.API) api = window.parent.API;
    if (window.API) api = window.API;
    return api;
}

function scormStart() {
    const API = scormGetAPI();
    if (!API) return;
    API.LMSInitialize("");
    API.LMSSetValue("cmi.core.lesson_status", "incomplete");
    API.LMSCommit("");
}

function scormFinish(score) {
    const API = scormGetAPI();
    if (!API) return;
    API.LMSSetValue("cmi.core.score.raw", score);
    API.LMSSetValue("cmi.core.lesson_status", "completed");
    API.LMSCommit("");
    API.LMSFinish("");
}
</script>

</body>
</html>
